<!doctype html>
<html lang="en">

<head>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Bootstrap CSS -->

  <link rel="stylesheet" href="sweetalert2.min.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">

  <link href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.1.3/css/bootstrap.min.css" rel="stylesheet">

  <link href="https://cdn.datatables.net/1.12.1/css/dataTables.bootstrap5.min.css" rel="stylesheet">

  <title>Attendance Table</title>
  <style>
    .btn {
      background-color: DodgerBlue;
      border: none;
      color: white;
      padding: 12px 16px;
      margin-top: 5px;
      margin-left: 7px;
      font-size: 16px;
      cursor: pointer;
    }


    .btn:hover {
      background-color: RoyalBlue;
    }

    .button-7 {
      background-color: #0095ff;

      border: 1px solid transparent;
      border-radius: 3px;
      box-shadow: rgba(255, 255, 255, .4) 0 1px 0 0 inset;
      box-sizing: border-box;
      color: #fff;
      cursor: pointer;
      display: inline-block;
      font-family: -apple-system, system-ui, "Segoe UI", "Liberation Sans", sans-serif;
      font-size: 13px;
      font-weight: 400;
      line-height: 1.15385;
      margin: 0;
      outline: none;
      padding: 8px .8em;
      position: relative;
      text-align: center;
      text-decoration: none;
      user-select: none;
      -webkit-user-select: none;
      touch-action: manipulation;
      vertical-align: baseline;
      white-space: nowrap;
    }


    .button-7:focus {
      background-color: #07c;
    }

    .button-7:focus {
      box-shadow: 0 0 0 4px rgba(0, 149, 255, .15);
    }

    .button-7:active {
      background-color: #0064bd;
      box-shadow: none;
    }




    .button-27 {
      appearance: none;
      background-color: #000000;
      border: 2px solid #1A1A1A;
      border-radius: 15px;
      box-sizing: border-box;
      color: #FFFFFF;
      cursor: pointer;
      display: inline-block;
      font-family: Roobert, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
      font-size: 16px;
      font-weight: 600;
      line-height: normal;
      margin: 0;
      min-height: 5px;
      min-width: 0;
      outline: none;
      padding: 8px 13px;
      text-align: center;
      text-decoration: none;
      transition: all 300ms cubic-bezier(.23, 1, 0.32, 1);
      user-select: none;
      -webkit-user-select: none;
      touch-action: manipulation;
      width: 10%;
      will-change: transform;
    }

    .button-27:disabled {
      pointer-events: none;
    }

    .button-27:hover {
      box-shadow: rgba(0, 0, 0, 0.25) 0 8px 15px;
      transform: translateY(-2px);
    }

    .button-27:active {
      box-shadow: none;
      transform: translateY(0);
    }



    .button-32 {
      background-color: #fff000;
      border-radius: 12px;
      color: #000;
      cursor: pointer;
      font-weight: bold;
      padding: 10px 15px;
      text-align: center;
      transition: 200ms;
      width: 8%;
      box-sizing: border-box;
      border: 0;
      font-size: 16px;
      user-select: none;
      -webkit-user-select: none;
      touch-action: manipulation;
    }

    .button-32:not(:disabled):hover,
    .button-32:not(:disabled):focus {
      outline: 0;
      background: #f4e603;
      box-shadow: 0 0 0 2px rgba(0, 0, 0, .2), 0 3px 8px 0 rgba(0, 0, 0, .15);
    }

    .button-32:disabled {
      filter: saturate(0.2) opacity(0.5);
      -webkit-filter: saturate(0.2) opacity(0.5);
      cursor: not-allowed;
    }

    .custom-select {
      position: relative;
      font-family: Arial;

    }

    .custom-select select {
      display: none;
    }

    .select-selected {
      margin-top: 20px;
      margin-bottom: -30px;
      background-color: #0e0e0e;
      width: 200px;
      padding-bottom: 30px;
      height: 35px;
      border-radius: 15px;
    }


    .select-selected:after {
      position: absolute;
      content: "";
      top: 14px;
      right: 10px;
      width: 0;
      height: 0;
      border: 6px solid transparent;
      border-color: #fff transparent transparent transparent;
    }


    .select-selected.select-arrow-active:after {
      border-color: transparent transparent #fff transparent;
      top: 7px;
    }


    .select-items div,
    .select-selected {
      color: #ffffff;
      padding: 5px 10px;
      border: 1px solid transparent;
      border-color: transparent transparent rgba(0, 0, 0, 0.1) transparent;
      cursor: pointer;
    }


    .select-items {
      position: absolute;
      background-color: DodgerBlue;
      top: 100%;
      left: 0;
      right: 0;
      z-index: 99;
    }

    .select-hide {
      display: none;
    }

    .select-items div:hover,
    .same-as-selected {
      background-color: rgba(0, 0, 0, 0.1);
    }

    .form-group {
      display: inline-block;
    }
  </style>





</head>

<body>


  <div>
    </form>
    <form action="/Attendance/makeAttendance" style="float:left">
      <button type="submit" class="btn btn-primary btn-block"> Make Attendance </button>
    </form>

    <form action="/Attendance/listPage" style="float:left">
      <button type="submit" class="btn btn-primary btn-block"> Attendance List</button>
    </form>

    <form action="/Auth/logOut" style="float:left">
      <button type="submit" class="btn btn-primary btn-block">Log Out</button>
    </form>
    <%if(isAdmin){%>
      <form action="/Users/userPage" style="float:left">
        <button type="submit" class="btn btn-primary btn-block form-group">Add User</button>
      </form>

      <form action="/Users/userListPage">
        <button type="submit" class="btn btn-primary btn-block form-group ">Users List</button>
      </form>
      <%}%>

  </div>
  <br>
  <br>
  <br>
  <br>
  <br>
  <div class="container">
    <% if(success && success.length) {%>
      <div class="alert alert-success alert-dismissible fade show" role="alert">
        <%= success %>
          <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
      </div>
      <% } %>

        <% if(error && error.length) {%>
          <div class="alert alert-danger alert-dismissible fade show" role="alert">
            <%= error %>
              <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
          </div>
          <% } %>
            <scrip src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/js/bootstrap.bundle.min.js"
              integrity="sha384-b5kHyXgcpbZJO/tY9Ul7kGkf1S0CWuKcCD38l8YkeH8z8QjE0GmW1gYU5S9FOnJ0"
              crossorigin="anonymous">
              </script>
              <h1 class="text-center text-primary mt-3 mb-3">Attendance Lists</h1>

              <div class="card">
                <div class="card-header">Attendance Data</div>
                <div class="card-body">
                  <div class="table-responsive">



                    <form action='/Attendance/date' method='post' style="display:inline-block">

                      <%if(!Listdate.month){%>
                        <div class="custom-select form-group" style="width:200px;">
                          <select id="drop" placeholder="SORT BY MONTH" name="month">
                            <option value="">choose a month...</option>
                            <option value=1>JANUARY</option>
                            <option value=2>FEBRUARY</option>
                            <option value=3>MARCH</option>
                            <option value=4>APRIL</option>
                            <option value=5>MAY</option>
                            <option value=6>JUNE</option>
                            <option value=7>JULY</option>
                            <option value=8>AUGUST</option>
                            <option value=9>SEPTEMBER</option>
                            <option value=10>OCTOBER</option>
                            <option value=11>NOVEMBER</option>
                            <option value=12>DECEMBER</option>
                          </select>
                        </div>

                        <%}else{%>
                          <div class="custom-select form-group" style="width:200px;">
                            <select id="drop" placeholder="SORT BY MONTH" name="month">
                              <option value="<%=Listdate.month%>">
                                <%=value%>
                              </option>
                              <option value=1>JANUARY</option>
                              <option value=2>FEBRUARY</option>
                              <option value=3>MARCH</option>
                              <option value=4>APRIL</option>
                              <option value=5>MAY</option>
                              <option value=6>JUNE</option>
                              <option value=7>JULY</option>
                              <option value=8>AUGUST</option>
                              <option value=9>SEPTEMBER</option>
                              <option value=10>OCTOBER</option>
                              <option value=11>NOVEMBER</option>
                              <option value=12>DECEMBER</option>
                            </select>
                          </div>
                          <%}%>


                            <h5 class="form-group">OR</h5>

                            <%if(date){%>

                              <input type="date" name="date" style="width:200px" id="date" value='<%=date%>'
                                class="formbold-form-input form-control form-group" />
                              <%}else{%>
                                <input type="date" name="date" style="width:200px" id="date" value="<%=date%>"
                                  class="formbold-form-input form-control form-group" />
                                <%}%>


                                  <button class="button-7 form-group" type="submit">SUBMIT </button>
                    </form>

                    <form action="/Attendance/delete" class=form-group>
                      <button class="button-27 " style="width:80px;" type="submit">RESET</button>
                    </form>
                    <button class="button-32" type="button" onclick="tableToCSV()" style="float:right">
                      EXPORT
                    </button>

                    <%if(isAdmin){%>
                      <form action="/Attendance/delchecks" id="myForm" method="post">
                        <input type="hidden" name="ss" id="ss" value="jsa" />
                        <button class="button-27" style="width:60px; float:right" type="submit" id="btn" name="btn"
                          onclick="selectcheck(event)" style="float:right">
                          <i class="fa fa-trash" style="font-size:30px"></i>
                        </button>
                      </form>




                      <form action="/Attendance/accdelete">
                        <input id="selectAll" type="checkbox" style=" display:inline-block; margin-left:1100px;"
                          class="form-check-input form-group"><label for='selectAll'>Select All</label>
                      </form>
                      <%}%>
                        <br><br>





                        <table id="attendance-datatable" class="table table-bordered">
                          <thead>
                            <tr>
                              <th> S No.</th>
                              <th> Name </th>
                              <th> Email</th>
                              <th> IN-Time</th>
                              <th> OUT-Time</th>
                              <th> Date</th>
                              <th>  Duration</th>
                              <%if(isAdmin){%>
                              <th> Actions</th>
                              <%}%>

                            </tr>
                          </thead>
                          <tbody></tbody>
                        </table>

                  </div>
                </div>
              </div>
  </div>
  <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
  <script src="https://code.jquery.com/jquery-3.5.1.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.3/font/bootstrap-icons.css"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
    crossorigin="anonymous"></script>
  <script src="https://cdn.datatables.net/1.12.1/js/jquery.dataTables.min.js"></script>
  <script src="https://cdn.datatables.net/1.12.1/js/dataTables.bootstrap5.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">




</body>

</html>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script src="sweetalert2.all.min.js"></script>
<script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
<script>

  function selectcheck(event) {
    var form = this



    console.log("shubham sharma")

    event.preventDefault();
    swal({
      title: "Are you sure?",
      text: "You will not be able to recover this attendance!",
      icon: "warning",
      buttons: [
        'No, cancel it!',
        'Yes, I am sure!'
      ],
      dangerMode: true,
    }).then(function (isConfirm) {
      console.log('asdasd')
      if (isConfirm) {
        var checkboxes = document.querySelectorAll('input[type="checkbox"]:checked')
        console.log(checkboxes)
        let arr = [];

        checkboxes.forEach((item) => {
          console.log(item.value)
          arr.push(item.value);
        })
        document.getElementById('ss').value = arr;
        document.getElementById('myForm').submit();
      } else {
        swal("Cancelled", "Your data is safe :)", "error");
      }
    })






  }




  $("#selectAll").click(function () {
    $("input[type=checkbox]").prop("checked", $(this).prop("checked"));
  });

  $("input[type=checkbox]").click(function () {
    if (!$(this).prop("checked")) {
      $("#selectAll").prop("checked", false);
    }
  });




  $(document).on('click', '.ItemDelete', function (e) {
    e.preventDefault();
    const url = $(this).attr('href');
    Swal.fire({
      title: $(this).attr("confirm_message"),
      type: 'warning',
      showCancelButton: !0,
      confirmButtonColor: '#3085d6',
      cancelButtonColor: '#d33',
      confirmButtonText: 'Yes!'
    }).then(function (t) {
      t.value && (window.location.href = url);
    });
  });

</script>
<script>

  $('#attendance-datatable').DataTable({
    aoColumnDefs: [
      {
        "defaultContent": "-",
        "targets": "_all"
      }


    ],
    stateSave: true,
    searchDelay: 700,
    aaSorting: [[0, 'desc']],
    processing: true,
    serverSide: true,
    ajax: {
      url: '/Attendance/list',
      data: {}
    },
    initComplete: (settings, json) => {
      $('.tableLoader').css('display', 'none');
    },
    language: {
      paginate: {
        previous: '<i class="mdi mdi-chevron-left">',
        next: '<i class="mdi mdi-chevron-right">'
      }
    },
    drawCallback: () => {
      $('.dataTables_paginate > .pagination').addClass('pagination-rounded');
    }
  })


  function tableToCSV() {

    // Variable to store the final csv data
    var csv_data = [];

    // Get each row data
    var rows = document.getElementsByTagName('tr');
    for (var i = 0; i < rows.length; i++) {

      // Get each column data
      var cols = rows[i].querySelectorAll('td,th');

      // Stores each csv row data
      var csvrow = [];
      for (var j = 0; j < cols.length - 1; j++) {

        // Get the text data of each cell
        // of a row and push it to csvrow
        csvrow.push(cols[j].innerHTML);
      }

      // Combine each column value with comma
      csv_data.push(csvrow.join(","));
    }

    // Combine each row data with new line character
    csv_data = csv_data.join('\n');

    // Call this function to download csv file 
    downloadCSVFile(csv_data);

  }

  function downloadCSVFile(csv_data) {

    // Create CSV file object and feed
    // our csv_data into it
    CSVFile = new Blob([csv_data], {
      type: "text/csv"
    });

    // Create to temporary link to initiate
    // download process
    var temp_link = document.createElement('a');

    // Download csv file
    temp_link.download = "Attendance.csv";
    var url = window.URL.createObjectURL(CSVFile);
    temp_link.href = url;

    // This link should not be displayed
    temp_link.style.display = "none";
    document.body.appendChild(temp_link);

    // Automatically click the link to
    // trigger download
    temp_link.click();
    document.body.removeChild(temp_link);
  }
  var x, i, j, l, ll, selElmnt, a, b, c;
  /* Look for any elements with the class "custom-select": */
  x = document.getElementsByClassName("custom-select");
  l = x.length;
  for (i = 0; i < l; i++) {
    selElmnt = x[i].getElementsByTagName("select")[0];
    ll = selElmnt.length;
    /* For each element, create a new DIV that will act as the selected item: */
    a = document.createElement("DIV");
    a.setAttribute("class", "select-selected");
    a.innerHTML = selElmnt.options[selElmnt.selectedIndex].innerHTML;
    x[i].appendChild(a);
    /* For each element, create a new DIV that will contain the option list: */
    b = document.createElement("DIV");
    b.setAttribute("class", "select-items select-hide");
    for (j = 1; j < ll; j++) {
      /* For each option in the original select element,
      create a new DIV that will act as an option item: */
      c = document.createElement("DIV");
      c.innerHTML = selElmnt.options[j].innerHTML;
      c.addEventListener("click", function (e) {
        /* When an item is clicked, update the original select box,
        and the selected item: */
        var y, i, k, s, h, sl, yl;
        s = this.parentNode.parentNode.getElementsByTagName("select")[0];
        sl = s.length;
        h = this.parentNode.previousSibling;
        for (i = 0; i < sl; i++) {
          if (s.options[i].innerHTML == this.innerHTML) {
            s.selectedIndex = i;
            h.innerHTML = this.innerHTML;
            y = this.parentNode.getElementsByClassName("same-as-selected");
            yl = y.length;
            for (k = 0; k < yl; k++) {
              y[k].removeAttribute("class");
            }
            this.setAttribute("class", "same-as-selected");
            break;
          }
        }
        h.click();
      });
      b.appendChild(c);
    }
    x[i].appendChild(b);
    a.addEventListener("click", function (e) {
      /* When the select box is clicked, close any other select boxes,
      and open/close the current select box: */
      e.stopPropagation();
      closeAllSelect(this);
      this.nextSibling.classList.toggle("select-hide");
      this.classList.toggle("select-arrow-active");
    });
  }

  function closeAllSelect(elmnt) {
    /* A function that will close all select boxes in the document,
    except the current select box: */
    var x, y, i, xl, yl, arrNo = [];
    x = document.getElementsByClassName("select-items");
    y = document.getElementsByClassName("select-selected");
    xl = x.length;
    yl = y.length;
    for (i = 0; i < yl; i++) {
      if (elmnt == y[i]) {
        arrNo.push(i)
      } else {
        y[i].classList.remove("select-arrow-active");
      }
    }
    for (i = 0; i < xl; i++) {
      if (arrNo.indexOf(i)) {
        x[i].classList.add("select-hide");
      }
    }
  }

  /* If the user clicks anywhere outside the select box,
  then close all select boxes: */
  document.addEventListener("click", closeAllSelect);











</script>